# 基础聚合函数

<cite>
**本文档引用的文件**  
- [builtin.rs](file://src/executor/builtin.rs#L49-L395)
- [runtime.rs](file://src/runtime.rs#L95-L104)
- [4.内置函数参考.md](file://dev_logs/4.内置函数参考.md#L9-L11)
</cite>

## 目录
1. [sum函数](#sum函数)  
2. [max函数](#max函数)  
3. [min函数](#min函数)  
4. [mean函数](#mean函数)  

## sum函数

`sum`函数用于计算数值的总和，支持数组输入和可变参数两种调用方式。该函数会自动跳过`null`值，确保计算的准确性。

**函数签名**  
```dplang
sum(array: array) -> number
sum(...values: number) -> number
```

**参数说明**  
- `array`: 一个包含数值的数组，函数将遍历数组并累加所有非`null`的数值。  
- `...values`: 可变参数形式，允许直接传入多个数值进行求和。

**边界情况处理**  
- 当输入为空数组或无参数时，函数返回`0.0`。  
- 数组中的`null`值会被自动跳过，不影响最终结果。  
- 如果所有输入值均为`null`，则返回`0.0`。

**性能特点**  
- 时间复杂度为O(n)，其中n为输入元素的数量。  
- 内部使用`f64`类型进行累加，确保浮点数精度。

**实际使用示例**  
在金融数据分析中，`sum`函数可用于计算一段时间内的总交易量：
```dplang
交易量 = [100, 150, null, 200, 250]
总交易量 = sum(交易量)  # 结果为700.0
```

**Section sources**  
- [builtin.rs](file://src/executor/builtin.rs#L49-L74)

## max函数

`max`函数用于返回一组数值中的最大值，支持数组输入和可变参数两种调用方式。该函数同样会自动跳过`null`值。

**函数签名**  
```dplang
max(array: array) -> number | null
max(...values: number) -> number | null
```

**参数说明**  
- `array`: 一个包含数值的数组，函数将遍历数组并找出最大值。  
- `...values`: 可变参数形式，允许直接传入多个数值进行比较。

**边界情况处理**  
- 当输入为空数组或无参数时，函数抛出类型错误。  
- 数组中的`null`值会被自动跳过。  
- 如果所有输入值均为`null`，则返回`null`。

**性能特点**  
- 时间复杂度为O(n)，其中n为输入元素的数量。  
- 使用`f64::NEG_INFINITY`作为初始值，确保正确处理负数。

**实际使用示例**  
在股票分析中，`max`函数可用于找出某段时间内的最高股价：
```dplang
股价 = [100, 105, 98, 110, 102]
最高股价 = max(股价)  # 结果为110.0
```

**Section sources**  
- [builtin.rs](file://src/executor/builtin.rs#L77-L101)

## min函数

`min`函数用于返回一组数值中的最小值，支持数组输入和可变参数两种调用方式。该函数同样会自动跳过`null`值。

**函数签名**  
```dplang
min(array: array) -> number | null
min(...values: number) -> number | null
```

**参数说明**  
- `array`: 一个包含数值的数组，函数将遍历数组并找出最小值。  
- `...values`: 可变参数形式，允许直接传入多个数值进行比较。

**边界情况处理**  
- 当输入为空数组或无参数时，函数抛出类型错误。  
- 数组中的`null`值会被自动跳过。  
- 如果所有输入值均为`null`，则返回`null`。

**性能特点**  
- 时间复杂度为O(n)，其中n为输入元素的数量。  
- 使用`f64::INFINITY`作为初始值，确保正确处理正数。

**实际使用示例**  
在成本分析中，`min`函数可用于找出最低采购成本：
```dplang
采购成本 = [50, 45, 55, 40, 60]
最低成本 = min(采购成本)  # 结果为40.0
```

**Section sources**  
- [builtin.rs](file://src/executor/builtin.rs#L103-L127)

## mean函数

`mean`函数用于计算一组数值的平均值，支持数组输入和可变参数两种调用方式。该函数会自动跳过`null`值，并处理空值情况。

**函数签名**  
```dplang
mean(array: array) -> number | null
mean(...values: number) -> number | null
```

**参数说明**  
- `array`: 一个包含数值的数组，函数将遍历数组并计算平均值。  
- `...values`: 可变参数形式，允许直接传入多个数值进行平均值计算。

**边界情况处理**  
- 当输入为空数组或无参数时，函数抛出类型错误。  
- 数组中的`null`值会被自动跳过。  
- 如果所有输入值均为`null`，则返回`null`。

**性能特点**  
- 时间复杂度为O(n)，其中n为输入元素的数量。  
- 先对所有非`null`值求和，再除以有效值的数量，确保计算精度。

**实际使用示例**  
在财务分析中，`mean`函数可用于计算月度平均收入：
```dplang
月收入 = [10000, 12000, null, 11000, 13000]
平均收入 = mean(月收入)  # 结果为11500.0
```

**Section sources**  
- [builtin.rs](file://src/executor/builtin.rs#L371-L395)