# 内置函数参考

<cite>
**Referenced Files in This Document**   
- [builtin.rs](file://src/executor/builtin.rs)
- [runtime.rs](file://src/runtime.rs)
- [4.内置函数参考.md](file://dev_logs/4.内置函数参考.md)
</cite>

## 目录
1. [简介](#简介)
2. [基础聚合函数](#基础聚合函数)
3. [数组操作函数](#数组操作函数)
4. [数组构造函数](#数组构造函数)
5. [高阶函数](#高阶函数)
6. [安全函数](#安全函数)
7. [工具函数](#工具函数)

## 简介
本文档基于DPLang语言的`builtin.rs`实现，对所有内置函数进行系统性分类和详细说明。文档涵盖了基础聚合函数、数组操作函数、数组构造函数、高阶函数、安全函数和工具函数六大类别，为开发者提供完整的函数参考手册。

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L1-L590)
- [4.内置函数参考.md](file://dev_logs/4.内置函数参考.md#L1-L263)

## 基础聚合函数
基础聚合函数用于对数值进行统计计算，包括求和、最大值、最小值和平均值等操作。

### sum 函数
求和函数，支持数组输入和可变参数两种调用方式。

**函数签名**
```
sum(array) -> number
sum(a, b, ...) -> number
```

**参数说明**
- `array`: 数值数组，支持包含null值
- `a, b, ...`: 可变数量的数值参数

**返回值**
- 数值类型，为所有非null元素的总和
- 空数组或无参数时返回0.0

**使用示例**
```dplang
sum([1, 2, 3])        -- 返回 6.0
sum(1, 2, 3)          -- 返回 6.0
sum([1, null, 3])     -- 返回 4.0
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L49-L74)

### max 函数
求最大值函数，返回数组或参数列表中的最大数值。

**函数签名**
```
max(array) -> number
max(a, b, ...) -> number
```

**参数说明**
- `array`: 数值数组
- `a, b, ...`: 可变数量的数值参数

**返回值**
- 数值类型，为所有非null元素中的最大值
- 空数组时返回null
- 至少需要一个参数

**使用示例**
```dplang
max([1, 5, 3])        -- 返回 5.0
max(1, 5, 3)          -- 返回 5.0
max([null, 3, 2])     -- 返回 3.0
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L77-L101)

### min 函数
求最小值函数，返回数组或参数列表中的最小数值。

**函数签名**
```
min(array) -> number
min(a, b, ...) -> number
```

**参数说明**
- `array`: 数值数组
- `a, b, ...`: 可变数量的数值参数

**返回值**
- 数值类型，为所有非null元素中的最小值
- 空数组时返回null
- 至少需要一个参数

**使用示例**
```dplang
min([1, 5, 3])        -- 返回 1.0
min(1, 5, 3)          -- 返回 1.0
min([null, 3, 2])     -- 返回 2.0
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L103-L127)

### mean 函数
计算平均值函数，返回数组或参数列表的算术平均数。

**函数签名**
```
mean(array) -> number
mean(a, b, ...) -> number
```

**参数说明**
- `array`: 数值数组
- `a, b, ...`: 可变数量的数值参数

**返回值**
- 数值类型，为所有非null元素的平均值
- 空数组时返回null
- 至少需要一个参数

**使用示例**
```dplang
mean([1, 2, 3])       -- 返回 2.0
mean(1, 2, 3)         -- 返回 2.0
mean([1, null, 3])    -- 返回 2.0
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L371-L395)

## 数组操作函数
数组操作函数提供对数组的各种处理能力，包括长度获取、拼接、元素访问等。

### length 函数
获取数组或字符串的长度。

**函数签名**
```
length(array|string) -> number
```

**参数说明**
- `array|string`: 数组或字符串类型

**返回值**
- 数值类型，表示数组元素个数或字符串字符数
- 参数必须是数组或字符串类型

**使用示例**
```dplang
length([1, 2, 3])     -- 返回 3.0
length("hello")        -- 返回 5.0
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L129-L139)

### concat 函数
数组拼接函数，将多个数组或元素连接成一个新数组。

**函数签名**
```
concat(arr1, arr2, ...) -> array
```

**参数说明**
- `arr1, arr2, ...`: 一个或多个数组，或单个元素

**返回值**
- 数组类型，包含所有输入数组的元素按顺序连接
- 空参数时返回空数组

**使用示例**
```dplang
concat([1, 2], [3, 4])    -- 返回 [1, 2, 3, 4]
concat([1, 2], 3, [4])    -- 返回 [1, 2, 3, 4]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L142-L157)

### first 函数
获取数组的第一个元素。

**函数签名**
```
first(array) -> value
```

**参数说明**
- `array`: 目标数组

**返回值**
- 任意类型，为数组的第一个元素
- 空数组时返回null

**使用示例**
```dplang
first([1, 2, 3])      -- 返回 1
first([])             -- 返回 null
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L397-L412)

### last 函数
获取数组的最后一个元素。

**函数签名**
```
last(array) -> value
```

**参数说明**
- `array`: 目标数组

**返回值**
- 任意类型，为数组的最后一个元素
- 空数组时返回null

**使用示例**
```dplang
last([1, 2, 3])       -- 返回 3
last([])              -- 返回 null
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L415-L431)

### reverse 函数
反转数组元素的顺序。

**函数签名**
```
reverse(array) -> array
```

**参数说明**
- `array`: 目标数组

**返回值**
- 数组类型，包含原数组元素但顺序反转
- 参数必须是数组类型

**使用示例**
```dplang
reverse([1, 2, 3])    -- 返回 [3, 2, 1]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L480-L493)

### sort 函数
对数组进行排序。

**函数签名**
```
sort(array) -> array
```

**参数说明**
- `array`: 目标数组

**返回值**
- 数组类型，包含排序后的元素
- 支持数字、字符串和null值的排序
- 数字按升序排列，字符串按字典序排列，null值排在最后

**使用示例**
```dplang
sort([3, 1, 2])       -- 返回 [1, 2, 3]
sort(["b", "a", "c"])  -- 返回 ["a", "b", "c"]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L433-L457)

### unique 函数
数组去重函数，移除重复元素。

**函数签名**
```
unique(array) -> array
```

**参数说明**
- `array`: 目标数组

**返回值**
- 数组类型，包含原数组的唯一元素，保持首次出现的顺序
- 参数必须是数组类型

**使用示例**
```dplang
unique([1, 2, 1, 3])  -- 返回 [1, 2, 3]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L460-L477)

## 数组构造函数
数组构造函数用于创建特定模式的数组。

### Range 函数
生成数字序列的构造函数。

**函数签名**
```
Range(start, end, step=1) -> array
```

**参数说明**
- `start`: 起始值（包含）
- `end`: 结束值（包含）
- `step`: 步长，默认为1

**返回值**
- 数组类型，包含从start到end按step递增的数字序列
- 步长不能为0

**使用示例**
```dplang
Range(1, 5)           -- 返回 [1, 2, 3, 4, 5]
Range(0, 10, 2)       -- 返回 [0, 2, 4, 6, 8, 10]
Range(10, 1, -1)      -- 返回 [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L295-L330)

### Array 函数
创建固定长度数组的构造函数。

**函数签名**
```
Array(size, default_value) -> array
Array(size, lambda) -> array
```

**参数说明**
- `size`: 数组长度
- `default_value`: 默认填充值
- `lambda`: 生成函数，接收索引参数

**返回值**
- 数组类型，长度为size
- 可以用固定值填充，或用lambda函数生成每个元素

**使用示例**
```dplang
Array(5, 0)           -- 返回 [0, 0, 0, 0, 0]
Array(5, i -> i*2)    -- 返回 [0, 2, 4, 6, 8]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L333-L366)

## 高阶函数
高阶函数接受函数作为参数，提供强大的函数式编程能力。

### map 函数
数组映射函数，对数组每个元素应用转换函数。

**函数签名**
```
map(array, lambda) -> array
```

**参数说明**
- `array`: 源数组
- `lambda`: 转换函数，接收数组元素作为参数

**返回值**
- 数组类型，包含对每个元素应用lambda后的结果
- lambda必须是有效的函数

**使用示例**
```dplang
map([1, 2, 3], x -> x * 2)     -- 返回 [2, 4, 6]
map([1, 2, 3], (x, i) -> x + i) -- 返回 [1, 3, 5]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L160-L188)

### filter 函数
数组过滤函数，筛选满足条件的元素。

**函数签名**
```
filter(array, lambda) -> array
```

**参数说明**
- `array`: 源数组
- `lambda`: 条件函数，返回布尔值

**返回值**
- 数组类型，包含lambda返回true的元素
- 保持原数组的元素顺序

**使用示例**
```dplang
filter([1, 2, 3, 4], x -> x > 2)  -- 返回 [3, 4]
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L191-L222)

### reduce 函数
数组归约函数，将数组元素聚合成单个值。

**函数签名**
```
reduce(array, lambda) -> value
reduce(array, initial, lambda) -> value
```

**参数说明**
- `array`: 源数组
- `initial`: 初始值（可选）
- `lambda`: 归约函数，接收累积值和当前元素

**返回值**
- 任意类型，为归约操作的结果
- lambda必须有两个参数
- 空数组时需要提供初始值

**使用示例**
```dplang
reduce([1, 2, 3, 4], (a, b) -> a + b)           -- 返回 10
reduce([1, 2, 3], 10, (a, b) -> a + b)           -- 返回 16
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L224-L270)

## 安全函数
安全函数提供容错能力，避免程序因异常情况而中断。

### safe_div 函数
安全除法函数，避免除零错误。

**函数签名**
```
safe_div(a, b, default=0.0) -> number
```

**参数说明**
- `a`: 被除数
- `b`: 除数
- `default`: 除零时的默认返回值

**返回值**
- 数值类型，为a除以b的结果
- 当b为0时返回default值

**使用示例**
```dplang
safe_div(10, 2)               -- 返回 5.0
safe_div(10, 0)               -- 返回 0.0
safe_div(10, 0, 999)          -- 返回 999.0
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L498-L517)

### safe_get 函数
安全数组访问函数，避免索引越界。

**函数签名**
```
safe_get(array, index, default=null) -> value
```

**参数说明**
- `array`: 目标数组
- `index`: 索引值，支持负数（从末尾计数）
- `default`: 越界时的默认返回值

**返回值**
- 任意类型，为指定索引的元素值
- 索引越界时返回default值

**使用示例**
```dplang
safe_get([1, 2, 3], 1)        -- 返回 2
safe_get([1, 2, 3], 5)        -- 返回 null
safe_get([1, 2, 3], 5, 0)     -- 返回 0
safe_get([1, 2, 3], -1)       -- 返回 3
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L520-L554)

### safe_number 函数
安全类型转换函数，避免转换失败。

**函数签名**
```
safe_number(value, default=0.0) -> number
```

**参数说明**
- `value`: 待转换的值
- `default`: 转换失败时的默认返回值

**返回值**
- 数值类型，为转换成功的结果
- 转换失败时返回default值

**使用示例**
```dplang
safe_number("123")            -- 返回 123.0
safe_number("abc")            -- 返回 0.0
safe_number("abc", 999)       -- 返回 999.0
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L557-L573)

## 工具函数
工具函数提供调试和类型检查等辅助功能。

### print 函数
输出调试函数，用于打印值到控制台。

**函数签名**
```
print(value1, value2, ...) -> null
```

**参数说明**
- `value1, value2, ...`: 一个或多个要打印的值

**返回值**
- null类型，无实际返回值
- 主要用于调试目的

**使用示例**
```dplang
print("Hello", 123)           -- 输出: "Hello" 123
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L273-L282)

### is_null 函数
null值检查函数，判断值是否为null。

**函数签名**
```
is_null(value) -> bool
```

**参数说明**
- `value`: 待检查的值

**返回值**
- 布尔类型，值为null时返回true，否则返回false

**使用示例**
```dplang
is_null(null)                 -- 返回 true
is_null(123)                  -- 返回 false
is_null("abc")                -- 返回 false
```

**Section sources**
- [builtin.rs](file://src/executor/builtin.rs#L284-L290)