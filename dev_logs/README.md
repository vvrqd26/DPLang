# DPLang v1.3 设计文档

欢迎查看 DPLang v1.3 设计文档！

## 文档结构

为提高可读性和 AI 处理效率，文档已拆分为以下部分：

1. **[核心设计](1.核心设计.md)** - 设计原则、执行过程、作用域和生命周期
2. **[语法参考](2.语法参考.md)** - 基本语法、条件分支、Lambda 表达式、高阶函数
3. **[类型系统和错误处理](3.类型系统和错误处理.md)** - 类型定义、转换、ERROR 块、安全函数
4. **[内置函数参考](4.内置函数参考.md)** - 所有内置函数的完整参考
5. **[完整示例](5.完整示例.md)** - 各种使用场景的完整代码示例
6. **[最佳实践](6.最佳实践.md)** - 编码规范、性能优化、错误处理建议

## 快速导航

### 新手入门
- 阅读 [核心设计](1.核心设计.md) 了解 DPLang 的设计理念
- 查看 [语法参考](2.语法参考.md) 学习基本语法
- 参考 [完整示例](5.完整示例.md) 中的简单示例

### 深入学习
- 学习 [Lambda 表达式](2.语法参考.md#lambda-表达式) 和 [高阶函数](2.语法参考.md#高阶函数)
- 掌握 [ERROR 块](3.类型系统和错误处理.md#error-块错误处理) 错误处理机制
- 查阅 [内置函数参考](4.内置函数参考.md) 了解所有可用函数

### 实践应用
- 参考 [完整示例](5.完整示例.md) 中的高级示例
- 遵循 [最佳实践](6.最佳实践.md) 编写高质量代码

## v1.3 主要特性

### 核心亮点

1. **纯函数数据脚本** - 天然并发安全，无副作用
2. **禁止变量遮蔽** - 强制清晰的数据流，编译期检测
3. **Lambda 表达式** - 支持高阶函数，消除循环
4. **ERROR 块** - 延迟声明的细粒度错误处理
5. **引用语义** - 时间序列函数不复制数据，高性能
6. **统一 number 类型** - 自动位宽/类型提升，简化使用

### v1.3 新增功能

相比 v1.2，v1.3 主要改进：

- ✅ **Lambda 表达式** - 单表达式、只读捕获外部变量
- ✅ **高阶函数** - map、filter、reduce
- ✅ **管道运算符** - `|>` 支持链式调用
- ✅ **数组构造** - Array()、Range() 函数
- ✅ **ERROR 块** - 明确延迟声明和执行流程
- ✅ **并发模型** - 数据脚本纯函数，包脚本顺序执行

## 快速示例

### 简单过滤

```DPLang
-- INPUT code:string, close:number --
-- OUTPUT code:string, close:number --

return close > 10 ? _args : null
```

### 使用 Lambda 和管道

```DPLang
-- INPUT code:string, prices:array --
-- OUTPUT code:string, 总收益:number --

成本 = 100
阈值 = 50

总收益 = prices
    |> filter(p -> p > 成本)
    |> map(p -> p - 成本)
    |> filter(profit -> profit > 阈值)
    |> reduce((sum, p) -> sum + p)

return [code, 总收益]
```

### 错误处理

```DPLang
-- INPUT code:string, open:number, close:number --
-- OUTPUT code:string, 涨跌幅:number --

-- ERROR --
if _error.type == "ZeroDivision":
    return [code, 0]
exit("错误: " + _error.message)
-- ERROR_END --

涨跌幅 = (close - open) / open * 100
return [code, 涨跌幅]
```

## 设计理念

DPLang 追求：

- **极简语法** - 无需 let/const/fn 等关键字
- **AI 友好** - 语法明确，token 消耗少
- **高性能** - 无闭包、禁止遮蔽，GC 压力小
- **并发安全** - 纯函数数据脚本，自然并发
- **声明式** - Lambda + 高阶函数，消除循环
- **领域专用** - 为金融分析量身定制

## 版本历史

- **v1.3** (当前) - 新增 Lambda、ERROR 块、管道运算符
- **v1.2** - 移除关键字、统一 number 类型、禁止遮蔽
- **v1.1** - 函数化时间序列、宏错误处理
- **v1.0** - 初始设计

## 参与贡献

欢迎提出建议和问题！

---

**DPLang** - 为金融分析而生的 DSL
