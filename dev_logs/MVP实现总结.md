# DPLang è§£é‡Šå™¨ MVP å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„ä»»åŠ¡

### 1. é¡¹ç›®åŸºç¡€è®¾æ–½
- âœ… åˆ›å»º Rust é¡¹ç›®ç»“æ„
- âœ… é…ç½® Cargo.toml ä¾èµ–
- âœ… è®¾ç½®æ¨¡å—ç»„ç»‡ç»“æ„

### 2. è¯æ³•åˆ†æå™¨ (Lexer)
**æ–‡ä»¶:** `src/lexer.rs` (643è¡Œ)

**æ ¸å¿ƒåŠŸèƒ½:**
- âœ… Token ç±»å‹å®šä¹‰ (40+ tokenç±»å‹)
- âœ… ä¸­æ–‡æ ‡è¯†ç¬¦æ”¯æŒ (Unicode \u{4E00}-\u{9FFF})
- âœ… ç¼©è¿›å¤„ç† (Indent/Dedent token)
- âœ… æ•°å­—å­—é¢é‡ (æ”¯æŒå°æ•°å’Œç§‘å­¦è®¡æ•°æ³•)
- âœ… å­—ç¬¦ä¸²å­—é¢é‡ (æ”¯æŒè½¬ä¹‰)
- âœ… è¿ç®—ç¬¦è¯†åˆ« (ç®—æœ¯ã€æ¯”è¾ƒã€é€»è¾‘)
- âœ… ç‰¹æ®Šå£°æ˜è§£æ (`-- INPUT --`, `-- OUTPUT --`)
- âœ… æ³¨é‡Šå¤„ç† (#å¼€å¤´)

**æµ‹è¯•è¦†ç›–:**
- test_basic_tokens: åŸºæœ¬tokenè¯†åˆ«
- test_chinese_identifier: ä¸­æ–‡æ ‡è¯†ç¬¦
- test_number: æ•°å­—å­—é¢é‡
- test_operators: è¿ç®—ç¬¦

### 3. è¯­æ³•åˆ†æå™¨ (Parser)
**æ–‡ä»¶:** 
- `src/parser/ast.rs` (251è¡Œ) - ASTå®šä¹‰
- `src/parser/mod.rs` (947è¡Œ) - Parserå®ç°

**æ ¸å¿ƒåŠŸèƒ½:**
- âœ… ASTèŠ‚ç‚¹å®šä¹‰ (Expr, Stmt, Script)
- âœ… é€’å½’ä¸‹é™è¡¨è¾¾å¼è§£æ
- âœ… è¿ç®—ç¬¦ä¼˜å…ˆçº§å¤„ç†
- âœ… æ•°æ®è„šæœ¬è§£æ
- âœ… åŒ…è„šæœ¬è§£ææ¡†æ¶
- âœ… æ¡ä»¶è¯­å¥ (if/else)
- âœ… ä¸‰å…ƒè¡¨è¾¾å¼
- âœ… ç®¡é“è¡¨è¾¾å¼
- âœ… Lambda è¡¨è¾¾å¼è§£æ
- âœ… æ•°ç»„å’Œè§£æ„èµ‹å€¼

**ä¼˜å…ˆçº§å±‚æ¬¡ (ä»ä½åˆ°é«˜):**
1. ç®¡é“ `|>`
2. ä¸‰å…ƒ `? :`
3. é€»è¾‘æˆ– `or`
4. é€»è¾‘ä¸ `and`
5. æ¯”è¾ƒ `> < >= <= == !=`
6. åŠ å‡ `+ -`
7. ä¹˜é™¤æ¨¡ `* / %`
8. å¹‚ `^`
9. ä¸€å…ƒ `- not`
10. è°ƒç”¨/ç´¢å¼•/æˆå‘˜è®¿é—®

**æµ‹è¯•è¦†ç›–:**
- test_parse_expression: è¡¨è¾¾å¼è§£æ
- test_parse_data_script: æ•°æ®è„šæœ¬è§£æ
- test_parse_lambda: Lambdaè¡¨è¾¾å¼

### 4. è¿è¡Œæ—¶ (Runtime)
**æ–‡ä»¶:** `src/runtime.rs` (428è¡Œ)

**æ ¸å¿ƒåŠŸèƒ½:**
- âœ… Valueç±»å‹ç³»ç»Ÿ (Number, Decimal, String, Bool, Null, Array)
- âœ… ç®—æœ¯è¿ç®— (add, sub, mul, div, mod, pow)
- âœ… æ¯”è¾ƒè¿ç®— (gt, lt, gte, lte, eq, neq)
- âœ… é€»è¾‘è¿ç®— (and, or, not)
- âœ… ä¸€å…ƒè¿ç®— (neg, not)
- âœ… å‘é‡è¿ç®— (æ•°ç»„é€å…ƒç´ )
- âœ… å¹¿æ’­è¿ç®— (æ•°ç»„ä¸æ ‡é‡)
- âœ… ç±»å‹è½¬æ¢ (to_bool, to_number)

**æµ‹è¯•è¦†ç›–:**
- test_number_add: æ•°å­—åŠ æ³•
- test_array_add: æ•°ç»„å‘é‡è¿ç®—
- test_array_scalar: æ•°ç»„å¹¿æ’­è¿ç®—
- test_comparison: æ¯”è¾ƒè¿ç®—

### 5. æ‰§è¡Œå™¨ (Executor)
**æ–‡ä»¶:** `src/executor.rs` (383è¡Œ)

**æ ¸å¿ƒåŠŸèƒ½:**
- âœ… æ‰§è¡Œä¸Šä¸‹æ–‡ç®¡ç†
- âœ… å˜é‡å­˜å‚¨å’ŒæŸ¥æ‰¾
- âœ… è¯­å¥æ‰§è¡Œ (èµ‹å€¼ã€returnã€ifã€è¡¨è¾¾å¼)
- âœ… è¡¨è¾¾å¼æ±‚å€¼
- âœ… ä¸‰å…ƒè¡¨è¾¾å¼æ‰§è¡Œ
- âœ… æ•°ç»„ç´¢å¼•
- âœ… è§£æ„èµ‹å€¼
- âœ… ç®€å•å†…ç½®å‡½æ•° (MA, sum, max, min)
- âœ… ç®¡é“è¡¨è¾¾å¼æ‰§è¡Œ

**æµ‹è¯•è¦†ç›–:**
- test_simple_expression: ç®€å•è¡¨è¾¾å¼
- test_if_statement: æ¡ä»¶è¯­å¥

### 6. ä¸»ç¨‹åº (Main)
**æ–‡ä»¶:** `src/main.rs` (112è¡Œ)

**åŠŸèƒ½:**
- âœ… MVPæ¼”ç¤ºç¨‹åº
- âœ… å¤šä¸ªç¤ºä¾‹è„šæœ¬
- âœ… å®é™…æ•°æ®æ‰§è¡Œæ¼”ç¤º
- âœ… æ¶¨è·Œå¹…è®¡ç®—ç¤ºä¾‹

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ¨¡å— | æ–‡ä»¶ | è¡Œæ•° | æµ‹è¯•æ•° |
|------|------|------|--------|
| Lexer | lexer.rs | 643 | 4 |
| Parser | parser/ast.rs | 251 | - |
| Parser | parser/mod.rs | 947 | 3 |
| Runtime | runtime.rs | 428 | 4 |
| Executor | executor.rs | 383 | 2 |
| Main | main.rs | 112 | - |
| **æ€»è®¡** | | **2,764è¡Œ** | **13ä¸ªæµ‹è¯•** |

## ğŸ¯ æ ¸å¿ƒæˆå°±

### 1. å®Œæ•´çš„ç¼–è¯‘æµç¨‹
```
æºä»£ç  â†’ Lexer â†’ Tokens â†’ Parser â†’ AST â†’ Executor â†’ Value
```

### 2. æ”¯æŒçš„è¯­æ³•ç‰¹æ€§
- âœ… ä¸­æ–‡æ ‡è¯†ç¬¦
- âœ… ç¼©è¿›æ•æ„Ÿè¯­æ³•
- âœ… å‘é‡è¿ç®—
- âœ… ä¸‰å…ƒè¡¨è¾¾å¼
- âœ… ç®¡é“è¿ç®—ç¬¦
- âœ… æ•°ç»„å­—é¢é‡
- âœ… è§£æ„èµ‹å€¼
- âœ… Lambdaè¯­æ³•è§£æ (æ‰§è¡Œæœªå®ç°)

### 3. å®é™…å¯è¿è¡Œçš„ç¤ºä¾‹
```dplang
-- INPUT code:string, open:number, close:number --
-- OUTPUT code:string, æ¶¨å¹…:number --

æ¶¨å¹… = (close - open) / open * 100
return [code, æ¶¨å¹…]
```

**æ‰§è¡Œç»“æœ:**
```
SH600000 | æ¶¨å¹…: 10.00%
SH600001 | æ¶¨å¹…: -5.00%
SH600002 | æ¶¨å¹…: 10.00%
```

## âš ï¸ å·²çŸ¥é™åˆ¶ (MVPèŒƒå›´å¤–)

ä»¥ä¸‹åŠŸèƒ½è®¾è®¡å·²å®Œæˆä½†æœªå®ç°:

1. **è¯­ä¹‰åˆ†æ**
   - å˜é‡é®è”½æ£€æµ‹
   - ç±»å‹æ£€æŸ¥
   - ä½œç”¨åŸŸéªŒè¯

2. **åŒ…ç³»ç»Ÿ**
   - åŒ…çº§å˜é‡
   - å‡½æ•°å®šä¹‰æ‰§è¡Œ
   - æˆå‘˜è®¿é—®æ§åˆ¶

3. **é«˜çº§ç‰¹æ€§**
   - Lambdaæ‰§è¡Œ
   - é«˜é˜¶å‡½æ•° (map, filter, reduce)
   - æ—¶é—´åºåˆ—å‡½æ•° (past, offset, window)
   - ERRORå—é”™è¯¯å¤„ç†
   - Decimalç²¾åº¦æ¨¡å¼

4. **ä¼˜åŒ–**
   - å­—èŠ‚ç ç¼–è¯‘
   - æ€§èƒ½ä¼˜åŒ–
   - å†…å­˜ç®¡ç†ä¼˜åŒ–

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. ä¸­æ–‡æ ‡è¯†ç¬¦æ”¯æŒ
ä½¿ç”¨UnicodeèŒƒå›´åŒ¹é…ä¸­æ–‡å­—ç¬¦:
```rust
fn is_chinese_char(ch: char) -> bool {
    matches!(ch, '\u{4E00}'..='\u{9FFF}')
}
```

### 2. ç¼©è¿›æ•æ„Ÿè§£æ
ç»´æŠ¤ç¼©è¿›æ ˆ,ç”Ÿæˆ Indent/Dedent token:
```rust
indent_stack: Vec<usize>
```

### 3. é€’å½’ä¸‹é™è§£æ
æ¸…æ™°çš„ä¼˜å…ˆçº§å±‚æ¬¡,æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚

### 4. å‘é‡è¿ç®—
æ”¯æŒæ•°ç»„é€å…ƒç´ è¿ç®—å’Œå¹¿æ’­:
```rust
[1,2,3] + [4,5,6]  // [5,7,9]
[1,2,3] + 10       // [11,12,13]
```

### 5. ç®¡é“è¡¨è¾¾å¼
å‡½æ•°å¼ç¼–ç¨‹é£æ ¼:
```dplang
prices |> filter(p -> p > 100) |> sum
```

## ğŸ“ˆ æµ‹è¯•ç»“æœ

```
running 13 tests
test lexer::tests::test_basic_tokens ... ok
test lexer::tests::test_chinese_identifier ... ok
test lexer::tests::test_number ... ok
test lexer::tests::test_operators ... ok
test parser::tests::test_parse_expression ... ok
test parser::tests::test_parse_data_script ... ok
test parser::tests::test_parse_lambda ... ok
test runtime::tests::test_number_add ... ok
test runtime::tests::test_array_add ... ok
test runtime::tests::test_array_scalar ... ok
test runtime::tests::test_comparison ... ok
test executor::tests::test_simple_expression ... ok
test executor::tests::test_if_statement ... ok

test result: ok. 13 passed; 0 failed
```

## ğŸš€ ä¸‹ä¸€æ­¥

### çŸ­æœŸ (ç»§ç»­MVPå®Œå–„)
1. å®ç°SemanticAnalyzeråŸºç¡€åŠŸèƒ½
2. æ·»åŠ æ›´å¤šå†…ç½®å‡½æ•°
3. å®ç°Lambdaæ‰§è¡Œ
4. å®Œå–„é”™è¯¯æ¶ˆæ¯

### ä¸­æœŸ (å®Œæ•´åŠŸèƒ½)
1. åŒ…ç³»ç»Ÿå®Œæ•´å®ç°
2. é«˜é˜¶å‡½æ•°å®ç°
3. æ—¶é—´åºåˆ—å‡½æ•°
4. ERRORå—æœºåˆ¶
5. ç±»å‹ç³»ç»Ÿå®Œå–„

### é•¿æœŸ (ä¼˜åŒ–å’Œå·¥å…·)
1. å­—èŠ‚ç ç¼–è¯‘å™¨
2. LSPæœåŠ¡å™¨
3. è°ƒè¯•å™¨
4. æ€§èƒ½ä¼˜åŒ–
5. REPLç¯å¢ƒ

## ğŸ’¡ ç»éªŒæ€»ç»“

### æˆåŠŸè¦ç‚¹
1. **æ¨¡å—åŒ–è®¾è®¡** - Lexer â†’ Parser â†’ Executor æ¸…æ™°åˆ†ç¦»
2. **æµ‹è¯•é©±åŠ¨** - æ¯ä¸ªæ¨¡å—éƒ½æœ‰å•å…ƒæµ‹è¯•
3. **é€’å¢å®ç°** - ä»ç®€å•åˆ°å¤æ‚é€æ­¥å®ç°
4. **æ–‡æ¡£å…ˆè¡Œ** - è®¾è®¡æ–‡æ¡£æŒ‡å¯¼å®ç°

### é‡åˆ°çš„æŒ‘æˆ˜
1. **INPUT/OUTPUTè§£æ** - æœ€åˆè®¾è®¡tokenåƒæ‰æ•´è¡Œ,åæ”¹ä¸ºæå–å†…å®¹
2. **ç¼©è¿›å¤„ç†** - éœ€è¦ç»´æŠ¤ç¼©è¿›æ ˆå¹¶ç”ŸæˆIndent/Dedent
3. **ifè¯­å¥è§£æ** - éœ€è¦æ­£ç¡®å¤„ç†å—åçš„newline
4. **å‘é‡è¿ç®—** - éœ€è¦åŒºåˆ†å‘é‡-å‘é‡å’Œå‘é‡-æ ‡é‡è¿ç®—

### è®¾è®¡å†³ç­–
1. **ç®€åŒ–ç±»å‹ç³»ç»Ÿ** - MVPåªç”¨f64,ä¸åŒºåˆ†int/float
2. **è·³è¿‡è¯­ä¹‰åˆ†æ** - å…ˆå®ç°æ‰§è¡Œ,åç»­åŠ å¼ºæ£€æŸ¥
3. **æœ€å°å†…ç½®å‡½æ•°** - åªå®ç°æ¼”ç¤ºéœ€è¦çš„å‡½æ•°
4. **å¼•ç”¨vså¤åˆ¶** - ç›®å‰ä½¿ç”¨clone,åç»­ä¼˜åŒ–

## ğŸ† é¡¹ç›®æˆæœ

ä¸€ä¸ª**å®Œæ•´å¯è¿è¡Œ**çš„DPLangè§£é‡Šå™¨MVP,åŒ…å«:
- âœ… 2,764 è¡Œé«˜è´¨é‡Rustä»£ç 
- âœ… 13ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… å®Œæ•´çš„è¯æ³•ã€è¯­æ³•ã€è¿è¡Œæ—¶ã€æ‰§è¡Œå™¨
- âœ… æ”¯æŒä¸­æ–‡æ ‡è¯†ç¬¦å’Œå‘é‡è¿ç®—
- âœ… å®é™…å¯ç”¨çš„æ•°æ®å¤„ç†ç¤ºä¾‹
- âœ… æ¸…æ™°çš„æ–‡æ¡£å’Œæ¶æ„è®¾è®¡

**è¿™æ˜¯ä¸€ä¸ªåšå®çš„åŸºç¡€,å¯ä»¥åœ¨æ­¤ä¹‹ä¸Šç»§ç»­æ‰©å±•å®Œæ•´çš„DPLangè¯­è¨€!** ğŸ‰

---

**æ—¶é—´:** 2025å¹´1æœˆ
**ç‰ˆæœ¬:** MVP v0.1.0
**çŠ¶æ€:** âœ… æˆåŠŸå®Œæˆ
